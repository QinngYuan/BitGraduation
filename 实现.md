# 大致实现方案

## PL端发送器

发送器中加入缓冲器。即上游模块把想要发送的数据写入到发送器中的FIFO（队列）里，发送器的控制逻辑检测到FIFO中有数据时，对FIFO中的数据进行一个检测识别（正则表达式），如果为规定的函数调用的形式，就读出来进行发送。因为发送器发送的速率比较慢，加入FIFO后，上游模块不用等待上一个数据发送完成就可以直接写入后续的数据。

根据提前约定好的波特率和校验方式，发送器的控制逻辑读出FIFO的数据后，按照UART的协议向外发送即可。

## PS端接收器

接收器中加入缓冲器。即接收器的控制逻辑接收到信息后，发送到缓冲器中。由于有缓冲器的存在，主控制器可以不必时时刻刻检查接收状态，只需要一定的时间检测缓冲器中是否有数据即可。

在接收时，起始位的低电平持续时间要超过半个周期才可以认为是开始，避免线路上干扰，引起错误接收。

在接收数据位、校验位、停止位时，采用倍频（16倍频）采样，使用中间的6、7、8、9、10这五次采样值作为采样依据，当五次全部为同一个电平时，即认为本位为此电平值；当四次相同，一次不同时，即认为本位与四次相同的电平值相同；当出现其他情况时，认为线路干扰太大，不做任何接收。

接收完成后，进行帧检测和校验，满足设计要求时，将其中的数据写入到FIFO中，并将FIFO中的数据发往运算器。

## PS端运算器

对FIFO中的数据进行所需功能的变换，具体实现待学习。

## PS端发送器

将运算后的数据加入缓冲器中，根据和PL端发送器相似的原理，但不必识别是否为函数调用，需增加一个标识，辨别与PL端函数调用对应的数据，并将其按照UART协议发往PL端。根据FIFO同样可实现近似流水线的发送。

## PL端接收器

PL端的接收器同PS端的接收器类似，但需要对PS端数据的标识进行识别，以辨别接收的数据对应哪个函数调用的结果。

## 模块实现图

![image-20240116081026579](C:\Users\gong\AppData\Roaming\Typora\typora-user-images\image-20240116081026579.png)



